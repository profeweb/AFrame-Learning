<html>
  <head>
      <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
      <script src="../randomColor/random-color.js"></script>
      <script src="snap.js"></script>
      <style>
          #overlay {
              position: absolute;
              z-index: 1;
              top: 0;
              left: 0;
              width: 100%;
              padding: 10px 0;
              /*   height: 100px; */
              display: flex;
              align-items: center;
              justify-content: center;
              opacity: 1;
              background-color: rgba(0, 0, 0, 0.6);
              color: #ffffff;
          }
          #overlay > div {
              text-align: center;
          }
          #overlay > div > button {
              background: transparent;
              color: #ffffff;
              border: 1px solid #ffffff;
              padding: 0.8em 2em;
              cursor: pointer;
              text-transform: uppercase;
          }

          #overlay > div > a {
              background: transparent;
              color: #ffffff;
              border: 1px solid #ffffff;
              padding: 0.8em 2em;
              cursor: pointer;
              text-decoration: none;
              text-transform: uppercase;
          }

          a-scene {
              display: block;
              position: relative;
              height: 100%;
              width: 100%;
          }

          #app {
              position: relative;
          }
      </style>
  </head>
  <body>
      <script>
          AFRAME.registerComponent('click-add', {

              init: function() {

                  this.raycaster = null
                  var scene = this.el.sceneEl;

                  this.el.addEventListener('click', e => {
                      let x = document.createElement('a-entity');
                      let intersection = this.raycaster.components.raycaster.getIntersection(this.el);
                      let pos = intersection.point.x +" "+intersection.point.y+" "+"-10.5";
                      x.setAttribute('position', pos);
                      x.setAttribute('mixin', 'voxel');
                      scene.appendChild(x);
                  });

                  this.el.addEventListener('raycaster-intersected', evt => {
                      this.raycaster = evt.detail.el;
                  });

                  this.el.addEventListener('raycaster-intersected-cleared', evt => {
                      this.raycaster = null;
                  });
              }
          });


      </script>
      <script>
          function setSnap(value){
              let v = "snap: "+value +" "+ value + " " + value;
              document.querySelector('#voxel').setAttribute('snap', v);
              document.querySelector('a-text').setAttribute('value', "snap: "+value);
          }
      </script>
      <div id="overlay">
          <div>
              <button onclick="setSnap(0.5);">SNAP 0.5</button>
              <button onclick="setSnap(1);">SNAP 1</button>
              <button onclick="setSnap(2);">SNAP 2</button>
              <button onclick="setSnap(5);">SNAP 5</button>
          </div>
      </div>

      <a-scene background="color:#222" cursor='rayOrigin: mouse' raycaster="objects:a-plane">

          <a-assets>
              <a-mixin id="voxel"
                       geometry="primitive: box; height: 0.5; width: 0.5; depth: 0.5"
                       material="shader: standard; color:red"
                       random-color
                       snap="offset: 0.25 0.25 0.25; snap: 0.5 0.5 0.5"
              ></a-mixin>
          </a-assets>

          <a-text value="snap:0.5" position = "0 1.6 -3"></a-text>

          <a-plane click-add position="0 0 -10" rotation="0 0 0" width="100" height="100"  color="#AAA"
                   material="wireframe:true;" segments-width="200" segments-height="200" ></a-plane>

      </a-scene>
  </body>

</html>
