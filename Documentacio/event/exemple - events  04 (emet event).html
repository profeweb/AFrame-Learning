<html>
  <head>
	<script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  </head>
  <body>
  <script>
      AFRAME.registerComponent('avisador', {
          schema:{
              missatge : {'type':'string'}
          },

          init: function() {

              this.enabled = false;
              this.id = this.el.getAttribute('id');
              this.color = this.el.getAttribute('material').color;

              this.el.addEventListener('click', (event) => {
                  console.log("CLICKED! " + event.target);
                  this.el.setAttribute('material', 'color', 'yellow');
                  this.enabled = true;
                  console.log(this.enabled);
              });

          },

          tick() {
              if (this.enabled) {
                  console.log("EMIT", 'avis', this.data.missatge);
                  this.el.emit('avis', {'missatge':this.data.missatge});
                  this.enabled = false;
                  console.log(this.enabled);
              }
          },

      });

  </script>
  <a-scene>

      <a-entity camera look-controls position="0 1 2">
          <a-entity cursor="fuse: true; fuseTimeout: 500;"
                    position="0 0 -1"
                    geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                    material="color: black; shader: flat">
          </a-entity>
      </a-entity>

      <a-entity avisador="missatge:Foooc!!!" geometry="primitive:box"  id="b1" position="-2 2 -3"  material="color:red" ></a-entity>
      <a-entity avisador="missatge:Pluja!!!" geometry="primitive:box"  id="b2" position="+0 2 -3"  material="color:blue" ></a-entity>
      <a-entity avisador="missatge:Vent!!!" geometry="primitive:box"  id="b3" position="+2 2 -3"  material="color:green" ></a-entity>
      <a-text id="t" value="Sense avisos"  position="0 3.5 -3"  color="black" align="center"></a-text>

  </a-scene>
  <script>

          document.addEventListener('DOMContentLoaded', function (){
              const scene = document.querySelector('a-scene');
              scene.addEventListener('avis', function(event) {
                  console.log('Detalls:', event.detail);
                  document.querySelector("#t").setAttribute('value', event.detail.missatge);
              });
          })

  </script>
  </body>
</html>
