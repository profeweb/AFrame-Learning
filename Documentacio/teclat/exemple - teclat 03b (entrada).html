<!DOCTYPE html>
<html>
<head>
    <title>A-Frame: Simple Keyboard Input</title>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="../../Components/a-frame-super-keyboard/aframe-super-keyboard.min.js"></script>
</head>

<body>
<script>

    AFRAME.registerComponent('keyboard-input', {

        init: function() {
            let self = this;

            this.el.addEventListener('superkeyboardinput', function(event) {

                let text = event.detail.value;
                console.log("Input: " + text);

                let num = parseInt(text);

                // Esborra les esferes anterios dins de l'entitat #grup
                document.querySelector('#grup').innerHTML="";

                // Crea les noves esferes dins l'entitat #grup
                for(let i=0; i<num; i++){
                    let novaEsfera = document.createElement('a-sphere');
                    novaEsfera.setAttribute('position', getRandomPosition());
                    novaEsfera.setAttribute('color', 'red');
                    document.querySelector('#grup').appendChild(novaEsfera);
                }


                // esborra la barra d'entrada (sense fer que el teclat desaparegui).
                self.el.setAttribute( "super-keyboard", "value", "" );

            });

            // Event de tancament del teclat (dismiss) per part de l'usuari
            this.el.addEventListener('superkeyboarddismiss', function(event){
                // En tancar feim esborrar el text, sense enviar-lo (submit).
                console.log("Input esborrat.");
                self.el.setAttribute( "super-keyboard", "value", "" );
            });
        },

        tick: function (time, timeDelta) {
            // obliga al teclat a estar visible després dels events d'entrada (input) o tancament (dismiss).
            if ( !this.el.object3D.visible )
                this.el.object3D.visible = true;
        }

    });

    function getRandomPosition() {
        let x = Math.random()*30 - 15;
        let y = 3 + Math.random()*6 - 3;
        let z = - 5;
        return x+" "+y+" "+z;
    }

</script>

<a-scene background="color:#222">

    <!-- Cursor per Desktop mode -->
    <a-entity id="mouseCursor" cursor="rayOrigin: mouse"></a-entity>

    <!-- Entitat on afegirem la quantitat d'esferes sol·licitadas per teclat -->
    <a-entity id="grup" position="0 1.6 -10"></a-entity>

    <!-- Super-teclat amb configuració de NUMPAD -->
    <a-entity id="keyboard" super-keyboard="hand: #mouseCursor;
                                            imagePath:../../Components/a-frame-super-keyboard/;
                                            filters: numbers; model: numpad; align: center; maxLength: 6;"
              position="0 1.5 -0.5" rotation="-30 0 0"  keyboard-input>
    </a-entity>
</a-scene>

</body>
</html>